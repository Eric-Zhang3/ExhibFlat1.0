/* Drag component for jQuery ( AMD Module ) | MIT Licenses | 2014-2-14 */
define(function(){var q={left:["left"],top:["top"],right:["left","Width"],bottom:["top","Height"]},F={axis:null,container:null,handle:null,moveHand:!0,proxy:!1,refresh:!0},k=$.browser.msie&&9>parseInt($.browser.version),B=k&&"6.0"===$.browser.version,s,n={capitalize:function(a){var b=a.charAt(0);return b.toUpperCase()+a.replace(b,"")},getPosition:function(a,b){var c=a.css("position");if("static"===c)return"auto";if("relative"===c)return"0px";var d=q[b][0],f=n.capitalize(d),e=a.offset()[d],g="right"===
b||"bottom"===b,l=0,m;if("absolute"===c){m=a[0].offsetParent;if("BODY"===m.tagName||"HTML"===m.tagName)m=window;c=$(m);$.isWindow(m)||(l=parseFloat(c.css("border"+f+"Width")));d=c.offset()[d]+l}else c=$(window),d=c["scroll"+f]();e-=d;return g?(g=q[b][1],c["inner"+g]()-a["outer"+g]()-e+"px"):e+"px"},getBoundary:function(a,b){var c=$.isWindow(a[0]),d=0,f=0,e=0,g=0,l=a.offset(),m=b.offset(),h=b.css("top"),k=b.css("left");"auto"===h&&(h=n.getPosition(b,"top"));"auto"===k&&(k=n.getPosition(b,"left"));
c?(c=a.scrollTop(),l=a.scrollLeft()):(c=l.top,l=l.left,d=a.css("borderTopWidth"),f=a.css("borderRightWidth"),e=a.css("borderBottomWidth"),g=a.css("borderLeftWidth"),"medium"===d&&(d="0px"),"medium"===f&&(f="0px"),"medium"===e&&(e="0px"),"medium"===g&&(g="0px"),d=parseFloat(d),f=parseFloat(f),e=parseFloat(e),g=parseFloat(g));c=c-m.top+parseFloat(h);l=l-m.left+parseFloat(k);return{top:c+d,right:l+a.outerWidth()-b.outerWidth()-f,left:l+g,bottom:c+a.outerHeight()-b.outerHeight()-e}},copyPosition:function(a,
b){var c=a.offset(),d=b.offset(),f=b.css("top"),e=b.css("left");"auto"===f&&(f=n.getPosition(b,"top"));"auto"===e&&(e=n.getPosition(b,"left"));b.animate({top:c.top-d.top+parseInt(f)+"px",left:c.left-d.left+parseInt(e)+"px"})},createProxy:function(a){var b=a.target,c=b.offset(),d=b.css("zIndex");d?d=parseInt(d)+1:(b.css("zIndex","1"),d="2");s||(s=$('<div class="ecope_drag_proxy" style="position:absolute;border:2px dashed #a0a1a2;"/>'));s.css({top:c.top+"px",left:c.left+"px",cursor:a.moveHand?"move":
"",width:a.width-4+"px",height:a.height-4+"px",zIndex:d});return s}},y=function(a,b){a=$(a).eq(0);b=b||{};if(a.length){var c=$.extend({},F,b),d=a.css("position"),f="fixed"===d||B&&void 0!==a[0].style.getExpression("top"),e=a[0].ownerDocument,g=e.defaultView||e.parentWindow,l=$(g),m=c.handle?$(c.handle):a,h=k?m:$(e),s=c.container?$(c.container):null,q=0,p=this,C=c.axis,D=!1,v=c.proxy,w=c.refresh,r,x,z,A,y,G="getSelection"in g?function(){g.getSelection().removeAllRanges()}:function(){try{e.selection.empty()}catch(a){}},
H=function(b){if(c.isDown&&(q++,0!==q%2)){var d=b.pageX,f=b.pageY,e=b.offsetX,g=b.offsetY,l=v?x[0].style:a[0].style,h,k,n;G();D=!0;void 0===e&&(e=b.originalEvent.layerX,g=b.originalEvent.layerY);z&&(h=d-z,r&&(k=r.left,n=r.right,h=h<k?k:h>n?n:h),l.left=h+"px",p.left=h,p.offsetLeft=d-e);A&&(e=f-A,r&&(h=r.top,k=r.bottom,e=e<h?h:e>k?k:e),l.top=e+"px",p.top=e,p.offsetTop=f-g);a.trigger("likedrag",[d,f]);$.ui.Drop&&(b.target===m[0]||"ecope_drag_proxy"===b.target.className)&&$.ui.Drop.fire(c,b,!0);b.stopPropagation()}},
E=function(b){void 0===b.offsetX&&(b.offsetX=b.originalEvent.layerX,b.offsetY=b.originalEvent.layerY);c.isDown=!1;k&&h.off("losecapture.drag");h.off("mousemove.drag mouseup.drag");k&&h[0].releaseCapture();D?(v?w?n.copyPosition(x,a):a.css("position","static"===d?"":d):w||a.css(y),B&&(f&&!v)&&a[0].style.setExpression("top","fuckIE6=document.documentElement.scrollTop+"+(p.top-l.scrollTop())+'+"px"'),D=!1,$.ui.Drop&&$.ui.Drop.fire(c,b,!1)):!w&&"static"===d&&a.css("position","");v&&x.remove();m.trigger("likedragend");
b.stopPropagation()};w&&"static"===d&&a.css("position","relative");c.moveHand&&m.css("cursor","move");m.on("mousedown.drag",function(b){c.isDown=!0;var g=a,t,u,q;c.width=a.outerWidth();c.height=a.outerHeight();w||(d=a.css("position"),"static"===d&&g.css("position","relative"));v&&(x=n.createProxy(c),g=x.appendTo(e.body),k&&(h=x));c.handle=h;t=g.css("left");u=g.css("top");q=g.offset();"auto"===u&&(u=n.getPosition(a,"top"));"auto"===t&&(t=n.getPosition(a,"left"));w||(y={left:t,top:u});p.left=t=parseInt(t);
p.top=u=parseInt(u);p.offsetLeft=q.left;p.offsetTop=q.top;z=b.pageX-t;A=b.pageY-u;if(!r&&s||f)r=n.getBoundary(f?l:s,g);C&&("x"===C?A=!1:"y"===C&&(z=!1));k&&h[0].setCapture();h.on("mousemove.drag",H).on("mouseup.drag",E);if(k)h.on("losecapture.drag",E);B&&(f&&!v)&&a[0].style.removeExpression("top");m.trigger("likedragstart");$.ui.Drop&&$.ui.Drop.refresh();b.stopPropagation();b.preventDefault()});c.originHandle=m;c.target=a;p.__o__=c}};y.prototype={destroy:function(){if(this.__o__){var a=this.__o__;
a.originHandle.css("cursor","").off("mousedown.drag likedragstart likedragend");a.isDown&&a.handle.trigger("mouseup");a.target.off("likedrag");this.__o__=null;delete this.__o__}},on:function(a,b){if(!this.__o__)return this;var c=this,d=this.__o__;("drag"===a?d.target:d.originHandle).on("like"+a,function(f,e,g){f.type=a;f.drag=d.target[0];e&&(f.pageX=e,f.pageY=g);b.call(c,f);f.stopPropagation()});return this},un:function(a){if(!this.__o__)return this;var b=this.__o__;("drag"===a?b.target:b.originHandle).off("like"+
a);return this}};$.ui||($.ui={});$.ui.Drag=y});
